<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PIX Direto - AmloPay</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        button { background: #24ca68; color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; font-size: 16px; }
        button:hover { background: #22c55e; }
        .result { margin-top: 20px; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-family: monospace; }
        .success { background: #f0fdf4; border: 1px solid #22c55e; color: #15803d; }
        .error { background: #fef2f2; border: 1px solid #f87171; color: #dc2626; }
    </style>
</head>
<body>
    <h1>üß™ Teste PIX Direto com AmloPay</h1>
    
    <button onclick="testarPixDireto()">üöÄ Testar PIX Direto</button>
    
    <div id="resultado"></div>

    <script>
        async function testarPixDireto() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<div class="result">‚è≥ Testando...</div>';

            try {
                // Configura√ß√µes AmloPay
                const config = {
                    publicKey: 'murillot2004_f443f52tx77685f5',
                    secretKey: '5gu5mbg909m53xs9cph9kb08dftavp2zyuzq7j05cm1uf20cuykqrxeq00dpprce',
                    baseUrl: 'https://app.amplopay.com/api/v1'
                };

                const payload = {
                    amount: 10.00,
                    currency: 'BRL',
                    payment_method: 'pix',
                    description: 'Teste PIX Direto - Doa√ß√£o Mo√ßambique',
                    customer: {
                        name: 'Teste Doador',
                        email: 'teste@vakinhadaafrica.site',
                        document: '00000000000'
                    }
                };

                // Testar m√∫ltiplos endpoints
                const endpoints = [
                    `${config.baseUrl}/payments`,
                    `${config.baseUrl}/charges`,
                    `${config.baseUrl}/pix`,
                    `${config.baseUrl}/transactions`
                ];

                let sucesso = false;
                let ultimoErro = '';

                for (const endpoint of endpoints) {
                    try {
                        console.log(`üß™ Testando: ${endpoint}`);
                        
                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Authorization': `Bearer ${config.secretKey}`,
                                'X-Public-Key': config.publicKey
                            },
                            body: JSON.stringify(payload)
                        });

                        const data = await response.text();
                        
                        console.log(`Status: ${response.status}`);
                        console.log(`Resposta: ${data.substring(0, 200)}...`);

                        if (response.ok) {
                            try {
                                const jsonData = JSON.parse(data);
                                resultado.innerHTML = `
                                    <div class="result success">
                                        ‚úÖ SUCESSO! Endpoint: ${endpoint}
                                        
                                        Status: ${response.status}
                                        
                                        Resposta:
                                        ${JSON.stringify(jsonData, null, 2)}
                                    </div>
                                `;
                                sucesso = true;
                                break;
                            } catch (e) {
                                resultado.innerHTML = `
                                    <div class="result success">
                                        ‚úÖ RESPOSTA OK! Endpoint: ${endpoint}
                                        
                                        Status: ${response.status}
                                        
                                        Resposta (n√£o-JSON):
                                        ${data}
                                    </div>
                                `;
                                sucesso = true;
                                break;
                            }
                        } else {
                            ultimoErro = `${endpoint}: Status ${response.status} - ${data.substring(0, 100)}`;
                        }

                    } catch (error) {
                        ultimoErro = `${endpoint}: ${error.message}`;
                        console.error(`‚ùå Erro em ${endpoint}:`, error);
                    }
                }

                if (!sucesso) {
                    resultado.innerHTML = `
                        <div class="result error">
                            ‚ùå TODOS OS ENDPOINTS FALHARAM
                            
                            √öltimo erro: ${ultimoErro}
                            
                            Poss√≠veis causas:
                            1. Credenciais inv√°lidas
                            2. Conta AmloPay n√£o ativa
                            3. API endpoint incorreto
                            4. Problemas de CORS
                        </div>
                    `;
                }

            } catch (error) {
                resultado.innerHTML = `
                    <div class="result error">
                        ‚ùå ERRO GERAL: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
